<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>RSI Admin • Welcome Text</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Libs -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- Ripple + Admin CSS -->
  <link href="../assets/ripple.css" rel="stylesheet">
  <link href="admin-page.css" rel="stylesheet">
</head>

<body>
  <div class="container-fluid dashboard-layout">
    <div class="row">
      <!-- Sidebar -->
      <div id="sidebar-placeholder"></div>


      <!-- Main -->
      <div class="col-sm-9 col-md-10 main-content">
        <div class="page-header">
          <h2>Welcome Text</h2>
          <p>Set a default Welcome Text in the Client Portal. This message can also be set in the Customer
            Portal.</p>
        </div>

        <!-- Welcome text (shown to Customer page for viewing only) -->
        <div class="panel">
          <div class="panel-heading">
            <i class="fa fa-home"></i>Welcome Text
          </div>
          <div class="panel-body">

            <!-- Live Preview -->
            <div class="form-group">
              <label>Preview (displayed in Client Portal)</label>
              <blockquote id="welcomePreview" class="blockquote-note" style="margin-top:0;">
                <em>The welcome text will appear here…</em>
              </blockquote>
            </div>
            <hr />

            <!-- Target Vessel -->
            <div class="form-group">
              <label for="targetVessel">Target Vessel</label>
              <select id="targetVessel" class="form-control" style="width:100%">
                <option value="all" selected>All Vessels (Default)</option>
                <option value="v1">MV Ocean Star</option>
                <option value="v2">MV Horizon</option>
                <option value="v3">MV Explorer</option>
              </select>
              <small class="help-block">
                Choose a vessel to set a custom message, or leave <b>All Vessels</b> for the default.
              </small>
            </div>

            <!-- Textarea -->
            <div class="form-group">
              <label for="welcomeText">Edit Welcome Text</label>
              <textarea id="welcomeText" class="form-control" rows="4"
                placeholder="Write the welcome text for the selected vessel or for all vessels..."></textarea>
              <p class="help-block" id="fallbackNote" style="display:none;">
                No custom message for this vessel — the default text will be used.
              </p>
            </div>

            <button class="btn btn-primary" id="saveWelcome">
              <i class="fa fa-save"></i> Save Welcome Text
            </button>

          </div>
        </div>


      </div><!-- /main -->
    </div>
  </div>


  <!-- JS -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script>
    $(function () {
      fetch('admin-sidebar.html')
        .then(response => response.text())
        .then(data => {
          const sidebarPlaceholder = document.getElementById('sidebar-placeholder');
          sidebarPlaceholder.innerHTML = data;

          // Script to set the active state after the sidebar is loaded
          const currentPage = 'admin-settings';
          const activeLink = sidebarPlaceholder.querySelector(`[data-page="${currentPage}"]`);
          if (activeLink) {
            activeLink.classList.add('active');
          }
        })
        .catch(error => console.error('Error fetching sidebar:', error));

      $('#saveWelcome').on('click', () => alert('Welcome text saved (demo).'));
      $('#saveFinal').on('click', () => alert('Final message & checkbox saved (demo).'));

      let editRow = null;
      $('#formUser').on('submit', function (e) {
        e.preventDefault();
        const idx = $('#userIndex').val();
        const name = $('#userName').val(), email = $('#userEmail').val(), role = $('#userRole').val();
        const row = `<tr>
          <td>${name}</td><td>${email}</td>
          <td><span class="label ${role === 'Super Admin' ? 'label-blue' : (role === 'Editor' ? 'label-gray' : 'label-light')}">${role}</span></td>
          <td>
            <button class="btn btn-xs btn-default edit-user"><i class="fa fa-pencil"></i></button>
            <button class="btn btn-xs btn-danger del-user"><i class="fa fa-trash"></i></button>
          </td>
        </tr>`;
        if (idx === '') $('#tblUsers tbody').append(row);
        else $('#tblUsers tbody tr').eq(parseInt(idx, 10)).replaceWith(row);
        $('#modalUser').modal('hide');
        this.reset();
        $('#userIndex').val('');
      });

      $(document).on('click', '.edit-user', function () {
        editRow = $(this).closest('tr');
        const i = editRow.index();
        $('#userIndex').val(i);
        $('#userName').val(editRow.children().eq(0).text().trim());
        $('#userEmail').val(editRow.children().eq(1).text().trim());
        $('#userRole').val(editRow.find('.label').text().trim());
        $('#modalUser').modal('show');
      });

      $(document).on('click', '.del-user', function () {
        if (confirm('Remove this admin user?')) $(this).closest('tr').remove();
      });
    });
  </script>
  <script>
    $(function () {
      $('#targetVessel').select2({ placeholder: 'Select Vessel', minimumResultsForSearch: 5 });

      const welcomeTexts = {
        all: 'Hi, {User}! Welcome to {Vessel} Smart Induction. \nYour registration is complete. To begin your journey, please provide your embarkation details and finish the onboarding process'
      };

      function renderPreview() {
        const txt = $('#welcomeText').val().trim();
        $('#welcomePreview').html(
          txt ? txt.replace(/\n/g, '<br>') : '<em>The welcome text will appear here…</em>'
        );
      }

      function loadText(vessel) {
        const txt = welcomeTexts[vessel];
        $('#welcomeText').val(txt || '');
        $('#fallbackNote').toggle(!txt && vessel !== 'all');
        renderPreview();
      }

      $('#targetVessel').on('change', function () {
        loadText(this.value);
      });

      $('#welcomeText').on('input', renderPreview);

      $('#saveWelcome').on('click', function () {
        const vessel = $('#targetVessel').val();
        welcomeTexts[vessel] = $('#welcomeText').val().trim();
        alert('Welcome text saved for ' + (vessel === 'all' ? 'All Vessels' : vessel) + ' (demo).');
        loadText(vessel);
      });

      // Init
      loadText($('#targetVessel').val());
    });

  </script>



</body>

</html>