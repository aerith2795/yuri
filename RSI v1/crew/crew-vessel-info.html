<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>RSI Crew â€¢ Vessel Info</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <!-- Ripple + Customer CSS -->
    <link href="../assets/ripple.css" rel="stylesheet" />
    <link href="page.css" rel="stylesheet" />
    <style>
        /* Retaining the original CSS for consistency */
        body {
            padding-bottom: 20px;
        }

        #journey-viewer {
            padding: 15px;
        }

        #journey-image-col {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 380px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #eee;
            padding: 10px;
        }

        #journey-image-col img {
            max-width: 100%;
            max-height: 360px;
            object-fit: contain;
        }

        #journey-content-col {
            min-height: 380px;
            max-height: 380px;
            overflow-y: auto;
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
        }

        #journey-navigation {
            margin-top: 15px;
            text-align: center;
        }

        .text-muted {
            color: #777;
        }

        .info-display {
            font-size: 16px;
            font-weight: bold;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 10px;
            border: 1px solid #e3e3e3;
        }
    </style>
</head>

<body>
    <div class="container-fluid dashboard-layout">
        <div class="row">
            <div id="sidebar-placeholder"></div>

            <div class="col-sm-9 col-md-10 main-content">
                <div class="page-header">
                    <h2 id="vesselTitle">Vessel Information</h2>
                    <p>Welcome aboard! Here you can find important details about the vessel and your next embarkation.
                    </p>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-ship"></i> <strong>Visual Journey Aboard: M/V Yurisan Dozo</strong>
                    </div>
                    <div class="panel-body">
                        <div id="journey-viewer">
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading"><i class="fa fa-anchor"></i> <strong>Next Embarkation Schedule</strong>
                    </div>
                    <div class="panel-body">
                        <div id="embarkation-details">
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script>
        $(function () {
            // --- GLOBALS ---
            let journeyBlocks = [];
            let currentIndex = 0;
            // Load sidebar
            fetch('crew-sidebar.html')
                .then(r => r.text())
                .then(data => {
                    $('#sidebar-placeholder').html(data);
                    $('[data-page="crew-vessel-info"]').addClass('active');
                });

            // --- DISPLAY FUNCTIONS ---

            /**
             * Renders a specific page/slide of the vessel journey.
             * @param {number} index - The index of the block to display.
             */
            function renderJourneyPage(index) {
                const viewer = $('#journey-viewer');
                if (!journeyBlocks || journeyBlocks.length === 0) {
                    viewer.html('<p class="text-center text-muted">No journey information has been configured by the captain.</p>');
                    return;
                }

                const slideData = journeyBlocks[index];
                const imageHtml = slideData.image
                    ? `<img src="${slideData.image}" alt="Vessel Journey Image">`
                    : '<p class="text-muted">No Image Provided</p>';

                const viewerHtml = `
            <div class="row">
                <div class="col-md-6" id="journey-content-col">${slideData.content}</div>
                <div class="col-md-6" id="journey-image-col">${imageHtml}</div>
            </div>
            <div id="journey-navigation" class="clearfix">
                <div class="pull-left">
                    <button class="btn btn-default" id="journey-prev-btn"><i class="fa fa-chevron-left"></i> Previous</button>
                </div>
                <div class="pull-right">
                    <span id="journey-page-indicator" style="margin: 0 10px; vertical-align: middle;"></span>
                    <button class="btn btn-default" id="journey-next-btn">Next <i class="fa fa-chevron-right"></i></button>
                </div>
            </div>
        `;
                viewer.html(viewerHtml);

                // Update page indicator and button states
                $('#journey-page-indicator').text(`Page ${index + 1} of ${journeyBlocks.length}`);
                $('#journey-prev-btn').prop('disabled', index === 0);
                $('#journey-next-btn').prop('disabled', index === journeyBlocks.length - 1);
            }

            /**
             * Populates the embarkation details section.
             * @param {object} embarkationData - The embarkation data object.
             */
            function displayEmbarkationInfo(embarkationData) {
                const container = $('#embarkation-details');
                if (!embarkationData || !embarkationData.date) {
                    container.html('<p class="text-center text-muted">The next embarkation schedule has not been set.</p>');
                    return;
                }

                const detailsHtml = `
            <div class="row">
                <div class="col-sm-4">
                    <label>Embarkation Date</label>
                    <p class="info-display">${embarkationData.date || 'N/A'}</p>
                </div>
                <div class="col-sm-4">
                    <label>Embarkation Time</label>
                    <p class="info-display">${embarkationData.time || 'N/A'}</p>
                </div>
                <div class="col-sm-4">
                    <label>Embarkation Location</label>
                    <p class="info-display">${embarkationData.location || 'N/A'}</p>
                </div>
            </div>
        `;
                container.html(detailsHtml);
            }

            // --- EVENT HANDLERS for Navigation ---
            $('#journey-viewer').on('click', '#journey-next-btn', function () {
                if (currentIndex < journeyBlocks.length - 1) {
                    currentIndex++;
                    renderJourneyPage(currentIndex);
                }
            });

            $('#journey-viewer').on('click', '#journey-prev-btn', function () {
                if (currentIndex > 0) {
                    currentIndex--;
                    renderJourneyPage(currentIndex);
                }
            });

            // --- ON PAGE LOAD ---
            function initializePage() {
                const savedPageData = JSON.parse(localStorage.getItem('vesselPageData'));

                if (!savedPageData) {
                    // Handle case where no data has ever been saved
                    $('#journey-viewer').html('<p class="text-center text-muted lead" style="padding: 40px 0;">Vessel information has not been configured by the captain or an officer.</p>');
                    $('#embarkation-details').html('<p class="text-center text-muted lead">Embarkation schedule is not available.</p>');
                    return;
                }

                // Populate embarkation info
                displayEmbarkationInfo(savedPageData.embarkation);

                // Populate visual journey
                journeyBlocks = savedPageData.journey || [];
                currentIndex = 0;
                renderJourneyPage(currentIndex);
            }

            initializePage();
        });
    </script>

</body>

</html>