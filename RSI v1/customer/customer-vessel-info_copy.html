<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>RSI Customer â€¢ Vessel Info</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Libs -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

  <!-- Summernote -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote.min.css" rel="stylesheet" />

  <!-- Ripple + Customer CSS -->
  <link href="../assets/ripple.css" rel="stylesheet" />
  <link href="page.css" rel="stylesheet" />

  <style>
    #aboutPreview {
      height: 300px;
      overflow-y: auto;
    }

    .vessel-carousel {
      height: 300px;
      overflow: hidden;
    }

    .vessel-carousel img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
    }

    #photoPreview .thumb {
      position: relative;
      display: inline-block;
      margin: 5px;
    }

    #photoPreview img {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    #photoPreview button.remove-photo {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #e74c3c;
      border: none;
      border-radius: 50%;
      color: #fff;
      width: 18px;
      height: 18px;
      font-size: 10px;
      line-height: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="container-fluid dashboard-layout">
    <div class="row">
      <!-- Sidebar -->
      <div id="sidebar-placeholder"></div>

      <!-- Main -->
      <div class="col-sm-9 col-md-10 main-content">
        <div class="page-header">
          <h2 id="vesselTitle">Vessel Configuration</h2>
          <p>Maintain vessel details to ensure accurate information is displayed in the crew portal.</p>
        </div>

                <!-- Next Voyage -->
        <div class="panel panel-default">
          <div class="panel-heading"><i class="fa fa-calendar"></i> Next Embarkation Schedule</div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-4 form-group">
                <label>Embarkation Date</label>
                <input type="date" id="embarkDate" class="form-control">
              </div>
              <div class="col-sm-4 form-group">
                <label>Embarkation Time</label>
                <input type="time" id="embarkTime" class="form-control">
              </div>
              <div class="col-sm-4 form-group">
                <label>Embarkation Location</label>
                <input type="text" id="embarkLocation" class="form-control" placeholder="e.g. Manila Port">
              </div>
            </div>
          </div>
        </div>

        <!-- Vessel Info -->
        <div class="panel">
          <div class="panel-heading">
            <i class="fa fa-ship"></i> Visual Journey Aboard
            <button id="editBtn" class="btn btn-primary btn-xs pull-right" data-toggle="collapse"
              data-target="#vesselInfoForm">
              <i class="fa fa-pencil"></i> Add/Edit Info
            </button>
          </div>
          <div class="panel-body">
            <!-- Edit Form -->
            <div id="vesselInfoForm" class="collapse">
              <form id="vesselForm">
                <div class="form-group">
                  <label>About the Vessel</label>
                  <textarea id="aboutVessel" class="form-control rich-text"></textarea>
                </div>
                <div class="form-group">
                  <label>Upload Vessel Photos (Max 5)</label>
                  <input type="file" id="vesselPhotos" class="form-control" accept="image/*" multiple />
                  <p class="help-block">Upload up to 5 images. Recommended size: 800x500px</p>
                  <div id="photoPreview"></div>
                </div>
                <button type="submit" class="btn btn-success">
                  <i class="fa fa-save"></i> Save
                </button>
                <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#vesselInfoForm">
                  <i class="fa fa-times"></i> Close
                </button>
              </form>
              <hr />
            </div>

            <!-- Preview Section -->
            <div class="row">
              <!-- About Vessel -->
              <div class="col-md-6">
                <h4><i class="fa fa-info-circle"></i> About the Vessel</h4>
                <div id="aboutPreview" class="well">
                  <p class="text-muted">No information available.</p>
                </div>
              </div>

              <!-- Vessel Photos -->
              <div class="col-md-6">
                <h4><i class="fa fa-picture-o"></i> Vessel Gallery</h4>
                <div id="vesselCarousel" class="carousel slide vessel-carousel" data-ride="carousel">
                  <div class="carousel-inner" id="carouselItems">
                    <div class="item active">
                      <div class="well text-center text-muted">No photos uploaded</div>
                    </div>
                  </div>
                  <a class="left carousel-control" href="#vesselCarousel" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                  </a>
                  <a class="right carousel-control" href="#vesselCarousel" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Activity Logs Config -->
        <div class="panel">
          <div class="panel-heading">
            <i class="fa fa-history"></i> Configure Activity Logs/History
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-4 form-group">
                <label>Number of logs to display</label>
                <input type="number" id="logCount" class="form-control" min="1" max="20" value="5">
              </div>
              <div class="col-sm-8 form-group">
                <label>Columns to display</label>
                <select id="logColumns" class="form-control select2" multiple>
                  <option value="Activity" selected>Activity</option>
                  <option value="Vessel">Vessel</option>
                  <option value="Disembark Date">Disembark Date</option>
                  <option value="Embark Date">Embark Date</option>
                  <option value="Location">Location</option>
                </select>
              </div>
            </div>
            <button id="saveLogsConfig" class="btn btn-success"><i class="fa fa-save"></i> Save Logs Config</button>
            <hr />
            <!-- Preview Table -->
            <h4>Preview (Client Portal)</h4>
            <table class="table table-bordered" id="logsPreview">
              <thead>
                <tr></tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" class="text-center text-muted">Sample activity logs will appear here</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div><!-- /main -->
    </div>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote.min.js"></script>

  <script>
    $(function () {
      // Sidebar
      fetch('customer-sidebar.html')
        .then(res => res.text())
        .then(data => {
          const sidebarPlaceholder = document.getElementById('sidebar-placeholder');
          sidebarPlaceholder.innerHTML = data;
          const activeLink = sidebarPlaceholder.querySelector('[data-page="customer-vessel-info"]');
          if (activeLink) activeLink.classList.add('active');
        });

      // Select2
      $('.select2').select2();

      // Summernote
      $('#aboutVessel').summernote({ height: 150 });

      // --- SYNC LOGIC ---
      let vesselConfig = {}; // FIX: initialize

      // Load existing config from localStorage
      const storedConfig = localStorage.getItem("vesselConfig");
      if (storedConfig) {
        vesselConfig = JSON.parse(storedConfig);
      } else {
        // --- SEED DEFAULT SAMPLE DATA ---
        vesselConfig = {
          aboutVessel: `
        <p><strong>M/V Yurisan Dozo</strong> is a state-of-the-art cargo and passenger vessel designed for
        efficiency, comfort, and safety at sea. Built with advanced navigation systems and modern facilities,
        it serves both regional and international routes. The vessel is known for its fuel efficiency,
        spacious cabins, and reliable performance under varying weather conditions.</p>

        <p>Onboard amenities include crew accommodations, passenger lounges, and a fully equipped bridge.
        The <em>M/V Yurisan Dozo</em> reflects the latest standards in maritime engineering, offering
        a balance between functionality and sustainability in ocean travel.</p>

        <ul>
          <li><strong>Length:</strong> 150 meters</li>
          <li><strong>Beam:</strong> 25 meters</li>
          <li><strong>Gross Tonnage:</strong> 20,000 GT</li>
          <li><strong>Passenger Capacity:</strong> 200</li>
          <li><strong>Crew Capacity:</strong> 50</li>
          <li><strong>Maximum Speed:</strong> 22 knots</li>
          <li><strong>Year Built:</strong> 2020</li>
          <li><strong>Flag:</strong> Panama</li>
        </ul>
        <p><em>Note: This is sample text. Please update with actual vessel information.</em></p>
      `,
          photos: [
            "https://cdn.prod.website-files.com/6246d8c921709e497eef110f/677cf09a70beff127b588b92_Understanding%20the%20Definition%20and%20Use%20of%20Vessel%20Number_11zon.jpg",
            "https://orbitshub.com/wp-content/uploads/2022/05/Blogs-Pictures-Orbitshub-marine-vessel-management-system-1910x1074-1.jpeg"
          ],
          logs: {
            count: 5,
            columns: ["Activity", "Vessel", "Embark Date"]
          }
        };
      }

      // Render about + carousel
      $('#aboutPreview').html(vesselConfig.aboutVessel || '<p class="text-muted">No information available.</p>');
      renderCarousel();

      // Prefill logs form
      $('#logCount').val(vesselConfig.logs.count);
      $('#logColumns').val(vesselConfig.logs.columns).trigger('change');
      renderLogsPreview();

      // Pre-fill About when editing
      $('#editBtn').on('click', function () {
        $('#aboutVessel').summernote('code', vesselConfig.aboutVessel || '');
        renderPhotoPreview();
      });

      // Handle photo uploads
      $('#vesselPhotos').on('change', function (e) {
        const files = Array.from(e.target.files);
        files.forEach(file => {
          if (vesselConfig.photos.length < 5) {
            const reader = new FileReader();
            reader.onload = function (ev) {
              vesselConfig.photos.push(ev.target.result);
              renderPhotoPreview();
            };
            reader.readAsDataURL(file);
          }
        });
        $(this).val('');
      });

      // Render photo previews
      function renderPhotoPreview() {
        $('#photoPreview').empty();
        vesselConfig.photos.forEach((src, i) => {
          $('#photoPreview').append(`
        <div class="thumb">
          <img src="${src}" alt="Vessel Photo ${i + 1}">
          <button type="button" class="remove-photo" data-index="${i}">&times;</button>
        </div>
      `);
        });
      }

      // Remove photo
      $('#photoPreview').on('click', '.remove-photo', function () {
        const idx = $(this).data('index');
        vesselConfig.photos.splice(idx, 1);
        renderPhotoPreview();
      });

      // Save form
      $('#vesselForm').on('submit', function (e) {
        e.preventDefault();

        // Load existing vesselConfig safely
        let stored = localStorage.getItem('vesselConfig');
        let config = stored ? JSON.parse(stored) : {};

        // Update vessel fields
        config.aboutVessel = $('#aboutVessel').summernote('code');
        config.photos = vesselConfig.photos;  // keep existing photos
        config.logs = vesselConfig.logs;      // keep logs setup

        // Save merged config
        localStorage.setItem("vesselConfig", JSON.stringify(config));

        $('#aboutPreview').html(config.aboutVessel || '<p class="text-muted">No information available.</p>');
        renderCarousel();
        $('#vesselInfoForm').collapse('hide');
        showAlert('Vessel info saved and synced with Crew Portal!', 'success');
      });


      // Render carousel
      function renderCarousel() {
        const carouselItems = $('#carouselItems').empty();
        if (vesselConfig.photos.length) {
          vesselConfig.photos.forEach((src, i) => {
            carouselItems.append(`
          <div class="item ${i === 0 ? 'active' : ''}">
            <img src="${src}" alt="Vessel Photo ${i + 1}">
          </div>
        `);
          });
        } else {
          carouselItems.append('<div class="item active"><div class="well text-center text-muted">No photos uploaded</div></div>');
        }
      }

      // Logs column preview
      $('#logColumns, #logCount').on('change', renderLogsPreview);

      function renderLogsPreview() {
        const cols = $('#logColumns').val();
        const count = parseInt($('#logCount').val(), 10) || 5;
        const headerRow = $('#logsPreview thead tr').empty();
        const tbody = $('#logsPreview tbody').empty();

        if (cols && cols.length) {
          cols.forEach(c => headerRow.append(`<th>${c}</th>`));
          for (let i = 0; i < count; i++) {
            let row = '<tr>';
            cols.forEach(c => row += `<td>Sample ${c} ${i + 1}</td>`);
            row += '</tr>';
            tbody.append(row);
          }
        } else {
          headerRow.empty();
          tbody.html('<tr><td colspan="4" class="text-center text-muted">Sample activity logs will appear here</td></tr>');
        }
      }

      // Save logs config
      $('#saveLogsConfig').on('click', function () {
        vesselConfig.logs = {
          count: parseInt($('#logCount').val(), 10),
          columns: $('#logColumns').val()
        };
        localStorage.setItem("vesselConfig", JSON.stringify(vesselConfig));
        renderLogsPreview();
        showAlert('Logs configuration saved!', 'success');
      });

      function showAlert(msg, type = 'success') {
        const alert = $(`<div class="alert alert-${type}" style="position:fixed;top:20px;right:20px;z-index:9999;">${msg}</div>`);
        $('body').append(alert);
        setTimeout(() => alert.fadeOut(500, () => alert.remove()), 2000);
      }
    });
  </script>

</body>

</html>