<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>RSI Customer • GDPR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Libs -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

    <!-- Ripple + Admin CSS -->
    <link href="../assets/ripple.css" rel="stylesheet" />
    <link href="page.css" rel="stylesheet" />
</head>

<body>
    <div class="container-fluid dashboard-layout">
        <div class="row">
            <!-- Sidebar -->
            <div id="sidebar-placeholder"></div>
            <!-- Main -->
            <div class="col-sm-9 col-md-10 main-content">
                <div class="page-header">
                    <h2>GDPR Configuration</h2>
                    <p>Setup vessel information and upload vessel photos</p>
                </div>

                <!-- Certificates -->
                <div class="tab-pane" id="gdpr">
                    <div class="panel">
                        <div class="panel-heading">
                            <i class="fa fa-shield"></i> GDPR
                            <button class="btn btn-primary btn-xs pull-right" id="btnAddText">
                                <i class="fa fa-plus"></i> Add Text
                            </button>
                        </div>
                        <div class="panel-body">
                            <table class="table table-bordered" id="gdprTable">
                                <thead>
                                    <tr>
                                        <th style="width: 28%">Title</th>
                                        <th>Body (excerpt)</th>
                                        <th style="width: 16%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>General Data Protection Policy</td>
                                        <td>
                                            RSI collects and processes personal data including names,
                                            contact information...
                                        </td>
                                        <td>
                                            <button class="btn btn-xs btn-default edit-text">
                                                <i class="fa fa-pencil"></i>
                                            </button>
                                            <button class="btn btn-xs btn-danger delete-text">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="form-group">
                                <label>Upload GDPR Document (optional)</label>
                                <input type="file" class="form-control">
                            </div>

                            <hr />
                            <div class="form-group">
                                <label>Page Instructions (shown on Crew GDPR tab)</label>
                                <textarea id="gdprInstructions" class="form-control" rows="3"
                                    placeholder="Provide a quick summary on why GDPR matters and what crew should do."></textarea>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" checked> Show GDPR page</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" checked> Include checkbox: “I have read and agree to the
                                    GDPR policy”</label>
                            </div>
                            <div class="checkbox">
                                <label><input type="checkbox" checked> Show Request Profile Deletion button</label>
                            </div>
                            <hr />
                            <button id="saveGdpr" class="btn btn-primary"><i class="fa fa-save"></i> Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal: Add/Edit GDPR Text -->
        <div class="modal fade" id="modalText">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form id="formText">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">
                                <i class="fa fa-file-text"></i> GDPR Text
                            </h4>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="textIndex" />
                            <div class="form-group">
                                <label>Title</label>
                                <input id="textTitle" type="text" class="form-control" required />
                            </div>
                            <div class="form-group">
                                <label>Body</label>
                                <textarea id="textBody" class="form-control" rows="8" required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-default" data-dismiss="modal">
                                Cancel
                            </button>
                            <button class="btn btn-primary" type="submit">
                                <i class="fa fa-save"></i> Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
    <script>
        $(function () {
            fetch('customer-sidebar.html')
                .then(response => response.text())
                .then(data => {
                    const sidebarPlaceholder = document.getElementById('sidebar-placeholder');
                    sidebarPlaceholder.innerHTML = data;

                    // Script to set the active state after the sidebar is loaded
                    const currentPage = 'customer-gdpr';
                    const activeLink = sidebarPlaceholder.querySelector(`[data-page="${currentPage}"]`);
                    if (activeLink) {
                        activeLink.classList.add('active');
                    }
                })
                .catch(error => console.error('Error fetching sidebar:', error));

            $('.select2').select2();
            
             $("#saveGdpr").on("click", function () {
                alert("Save GDPR Config (demo)");
            });

            // Visibility
            $("#showGdpr").on("change", function () {
                alert(
                    "GDPR page " +
                    (this.checked ? "visible" : "hidden") +
                    " for Crew (demo)."
                );
            });

            // Add text
            let editRow = null;
            $("#btnAddText").on("click", function () {
                $("#textIndex").val("");
                $("#textTitle").val("");
                $("#textBody").val("");
                $("#modalText").modal("show");
            });

            $(document).on("click", ".edit-text", function () {
                editRow = $(this).closest("tr");
                const i = editRow.index();
                $("#textIndex").val(i);
                $("#textTitle").val(editRow.children().eq(0).text().trim());
                $("#textBody").val(editRow.children().eq(1).text().trim());
                $("#modalText").modal("show");
            });

            $(document).on("click", ".delete-text", function () {
                if (confirm("Delete this GDPR text?")) $(this).closest("tr").remove();
            });

            $("#formText").on("submit", function (e) {
                e.preventDefault();
                const idx = $("#textIndex").val();
                const t = $("#textTitle").val(),
                    b = $("#textBody").val();
                const excerpt = b.length > 120 ? b.substr(0, 117) + "..." : b;
                const row = `<tr>
          <td>${t}</td><td>${excerpt}</td>
          <td>
            <button class="btn btn-xs btn-default edit-text"><i class="fa fa-pencil"></i></button>
            <button class="btn btn-xs btn-danger delete-text"><i class="fa fa-trash"></i></button>
          </td>
        </tr>`;
                if (idx === "") $("#gdprTable tbody").append(row);
                else $("#gdprTable tbody tr").eq(parseInt(idx, 10)).replaceWith(row);

                $("#modalText").modal("hide");
            });

            let editMode = null; // track row being edited

            

        });


    </script>
</body>

</html>