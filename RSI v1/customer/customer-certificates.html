<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>RSI Customer • Certificates</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <link href="../assets/ripple.css" rel="stylesheet" />
  <link href="page.css" rel="stylesheet" />
  <style>
    body {
      padding-bottom: 80px;
    }

    .sticky-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #f5f5f5;
      border-top: 1px solid #ddd;
      padding: 10px 0;
      z-index: 1000;
    }

    .footer-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 15px;
    }

    .cert-description {
      color: #777;
      font-size: 12px;
    }

    .table .label {
      margin-right: 5px;
      margin-bottom: 5px;
      display: inline-block;
    }

    #certInstructions {
      resize: none;
    }

    /* Table layout */
    #certTable {
      table-layout: fixed;
      word-wrap: break-word;
    }

    .col-details {
      width: 25%;
    }

    .col-requirements {
      width: 20%;
    }

    .col-actions {
      width: 100px;
      text-align: center;
    }

    /* Disabled state for buttons instead of hiding */
    .edit-controls .btn:disabled {
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <div class="container-fluid dashboard-layout">
    <div class="row">
      <div id="sidebar-placeholder"></div>
      <div class="col-sm-9 col-md-10 main-content">
        <div class="page-header">
          <h2>Certificates Configuration</h2>
          <p>Define which certificates are required from crew during registration.</p>
        </div>

        <div class="panel">
          <div class="panel-heading"><i class="fa fa-hdd-o"></i> Storage Quota
            <i class="fa fa-info-circle small pull-right" data-toggle="tooltip"
              title="You have used 82% of your 500 MB storage quota." style="cursor:pointer;"></i>
          </div>
          <div class="panel-body">
            <h4>82% of 500 MB Used</h4>
            <div class="progress" style="margin-bottom:0;">
              <div class="progress-bar progress-bar-info" style="width:82%" title="410 MB Used"></div>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading"><i class="fa fa-info-circle"></i> General Instructions for Crew</div>
          <div class="panel-body"><textarea class="form-control" id="certInstructions" rows="2" disabled></textarea>
          </div>
        </div>

        <div class="panel">
          <div class="panel-heading">
            <i class="fa fa-list"></i> Required Certificates
            <button class="btn btn-primary btn-xs pull-right" id="btnAddCert"><i class="fa fa-plus"></i> Add
              Certificate</button>
          </div>
          <div class="panel-body">
            <div class="form-group">
              <label for="certSearch">Search Certificates</label>
              <input type="text" id="certSearch" class="form-control" placeholder="Type to filter by name...">
            </div>
            <table class="table table-bordered" id="certTable">
              <thead>
                <tr>
                  <th>Certificate</th>
                  <th class="col-details">Details</th>
                  <th class="col-requirements">Requirements</th>
                  <th class="col-actions">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sticky-footer">
    <div class="footer-container" id="footer-btn-container"></div>
  </div>

  <div class="modal fade" id="modalCert">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form id="formCert">
          <div class="modal-header">
            <h4 class="modal-title">Add / Edit Certificate</h4>
          </div>
          <div class="modal-body"><input type="hidden" id="certRowIndex">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group"><label>Certificate Name</label><input id="certName" type="text"
                    class="form-control" required></div>
                <div class="form-group"><label>Category</label><input id="certCategory" type="text" class="form-control"
                    placeholder="e.g., Identity, Health, Safety"></div>
                <div class="form-group"><label>Description</label><textarea id="certDesc" class="form-control"
                    rows="2"></textarea></div>
                <div class="form-group"><label>Instructions for Crew</label><textarea id="certInstructionsPerCert"
                    class="form-control" rows="2"></textarea></div>
              </div>
              <div class="col-md-6">
                <div class="form-group"><label>Type</label><input id="certType" type="text" class="form-control"
                    placeholder="e.g., Document, Medical"></div>
                <div class="form-group"><label>Code</label><input id="certCode" type="text" class="form-control"
                    placeholder="e.g., SBK-01"></div>
                <div class="row">
                  <div class="col-sm-6 form-group"><label>Allowed File Type</label><select id="certAllowedFileType"
                      class="form-control">
                      <option value="any">Any</option>
                      <option value="pdf">PDF</option>
                      <option value="image">Image (jpg/png)</option>
                    </select></div>
                  <div class="col-sm-6 form-group"><label>Max Size (MB)</label><input id="certMaxSize" type="number"
                      class="form-control" value="5" min="1"></div>
                </div>
                <hr>
                <div class="checkbox" style="margin-top:20px;"><label><input id="certIsRequired" type="checkbox">
                    <strong>Required to Fill In Details</strong></label></div>
                <div class="checkbox"><label><input id="certRequireUpload" type="checkbox"> <strong>Required to Upload
                      File</strong></label></div>
              </div>
            </div>
          </div>
          <div class="modal-footer"><button type="button" class="btn btn-default"
              data-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary">Save
              Certificate</button></div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script>
    $(function () {
      // --- INITIALIZATION & DATA ---
      $('#sidebar-placeholder').html('<div class="well">Customer Sidebar</div>');
      $('[data-toggle="tooltip"]').tooltip();

      const configKey = "certificatesConfig";
      let config = {};
      const defaultCerts = [{ name: "Passport", type: "Document", code: "DOC-001", category: "Identity", desc: "Valid passport for international travel.", isRequired: true, requireUpload: true }, { name: "Seaman’s Book", type: "Document", code: "SBK-101", category: "Identity", desc: "Official seafarer identification booklet.", isRequired: true, requireUpload: true }, { name: "Basic Safety Training (BST)", type: "Training", code: "BST-201", category: "Safety", desc: "Mandatory STCW safety training.", isRequired: true, requireUpload: true }, { name: "Medical Certificate", type: "Medical", code: "MED-310", category: "Health", desc: "Issued by an approved maritime medical examiner.", isRequired: true, requireUpload: true }];

      // --- CORE FUNCTIONS ---
      function toggleViewMode(isEditing) {
        $('#certInstructions').prop('disabled', !isEditing);
        $('#btnAddCert, .edit-cert, .delete-cert').prop('disabled', !isEditing); // Disable/enable buttons

        if (isEditing) {
          $('#footer-btn-container').html('<button id="saveBtn" class="btn btn-success btn-block"><i class="fa fa-save"></i> Save Changes</button>');
        } else {
          $('#footer-btn-container').html('<button id="editBtn" class="btn btn-primary btn-block"><i class="fa fa-pencil"></i> Edit Configuration</button>');
        }
      }

      function saveConfig() {
        config.instructions = $('#certInstructions').val();
        localStorage.setItem(configKey, JSON.stringify(config));
        alert("Configuration saved!");
        toggleViewMode(false);
      }

      function loadConfig() {
        const savedConfig = JSON.parse(localStorage.getItem(configKey));
        if (savedConfig) {
          config = savedConfig;
        } else {
          config = { instructions: "Please upload clear, readable copies of all required certificates.", certificates: defaultCerts };
        }
        $('#certInstructions').val(config.instructions);
        renderCertTable();
        return !!savedConfig;
      }

      function renderCertTable() {
        const tbody = $('#certTable tbody').empty();
        if (!config.certificates || config.certificates.length === 0) {
          tbody.append(`<tr><td colspan="4" class="text-muted text-center">No certificates defined.</td></tr>`);
          return;
        }
        config.certificates.forEach((c, i) => {
          const row = `
                        <tr data-index="${i}">
                            <td><strong>${c.name}</strong><p class="cert-description">${c.desc || ''}</p></td>
                            <td><span class="label label-light">${c.type || '-'}</span><span class="label label-light">${c.code || '-'}</span><span class="label label-light">${c.category || '-'}</span></td>
                            <td><span class="label ${c.isRequired ? 'label-red' : 'label-gray'}">Fill Details</span> <span class="label ${c.requireUpload ? 'label-blue' : 'label-gray'}">Upload File</span></td>
                            <td class="col-actions edit-controls">
                                <button class="btn btn-xs btn-default edit-cert"><i class="fa fa-pencil"></i></button>
                                <button class="btn btn-xs btn-danger delete-cert"><i class="fa fa-trash"></i></button>
                            </td>
                        </tr>`;
          tbody.append(row);
        });
      }

      // --- EVENT HANDLERS ---
      $('#footer-btn-container').on('click', '#saveBtn', saveConfig);
      $('#footer-btn-container').on('click', '#editBtn', () => toggleViewMode(true));

      $('#certSearch').on('input', function () {
        const query = $(this).val().toLowerCase();
        $('#certTable tbody tr').each(function () {
          const certName = $(this).find('strong').text().toLowerCase();
          $(this).toggle(certName.includes(query));
        });
      });

      $('#btnAddCert').on('click', function () {
        $('#formCert')[0].reset();
        $('#certRowIndex').val('');
        $('#modalCert .modal-title').text('Add Certificate');
        $('#modalCert').modal('show');
      });

      $('#certTable').on('click', '.edit-cert', function () {
        const index = $(this).closest('tr').data('index');
        const cert = config.certificates[index];
        if (cert) {
          $('#certRowIndex').val(index);
          $('#certName').val(cert.name); $('#certCategory').val(cert.category);
          $('#certType').val(cert.type); $('#certCode').val(cert.code);
          $('#certDesc').val(cert.desc); $('#certInstructionsPerCert').val(cert.instructions);
          $('#certIsRequired').prop('checked', cert.isRequired);
          $('#certRequireUpload').prop('checked', cert.requireUpload);
          $('#modalCert .modal-title').text('Edit Certificate');
          $('#modalCert').modal('show');
        }
      });

      $('#certTable').on('click', '.delete-cert', function () {
        if (!confirm('Are you sure you want to delete this certificate?')) return;
        const index = $(this).closest('tr').data('index');
        config.certificates.splice(index, 1);
        renderCertTable();
        toggleViewMode(true); // Re-apply disabled state after re-render
      });

      $('#formCert').on('submit', function (e) {
        e.preventDefault();
        const index = $('#certRowIndex').val();
        const certData = { name: $('#certName').val(), category: $('#certCategory').val(), type: $('#certType').val(), code: $('#certCode').val(), desc: $('#certDesc').val(), instructions: $('#certInstructionsPerCert').val(), isRequired: $('#certIsRequired').prop('checked'), requireUpload: $('#certRequireUpload').prop('checked') };
        if (index === '') {
          config.certificates.push(certData);
        } else {
          config.certificates[parseInt(index, 10)] = certData;
        }
        renderCertTable();
        toggleViewMode(true); // Re-apply disabled state after re-render
        $('#modalCert').modal('hide');
      });

      // --- INITIAL LOAD ---
      const hasData = loadConfig();
      toggleViewMode(!hasData);
    });
  </script>
</body>

</html>